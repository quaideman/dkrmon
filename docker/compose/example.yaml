version: '2.2'
services:
  nginx01:
    image: "nginx:alpine"
    ports:
      - "80"
    mem_limit: 10m
    mem_reservation: 5m
    healthcheck:
      test: ["CMD-SHELL", "stat /etc/passwd || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3

  nginx02:
    image: "nginx:alpine"
    ports:
      - "80"
    mem_limit: 10m
    mem_reservation: 5m
    cpus: 0.5
    healthcheck:
      test: ["CMD-SHELL", "stat /etc/passwd || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3

  nginx03:
    image: "nginx:alpine"
    ports:
      - "80"
    mem_limit: 10m
    mem_reservation: 5m
    cpus: 0.5
    healthcheck:
      test: ["CMD-SHELL", "stat /etc/passwd || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3

  nginx04:
    image: "nginx:alpine"
    ports:
      - "80"
    mem_limit: 10m
    mem_reservation: 5m
    cpus: 0.5
    healthcheck:
      test: ["CMD-SHELL", "stat /etc/passwd || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3

  nginx05:
    image: "nginx:alpine"
    ports:
      - "80"
    mem_limit: 10m
    mem_reservation: 5m
    healthcheck:
      test: ["CMD-SHELL", "stat /etc/passwd || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3

  httpd01:
    image: "httpd:alpine"
    ports:
      - "80"
    mem_limit: 10m
    mem_reservation: 5m
    healthcheck:
      test: ["CMD-SHELL", "stat /etc/passwd || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3

  httpd02:
    image: "httpd:alpine"
    ports:
      - "80"
    mem_limit: 10m
    mem_reservation: 5m
    healthcheck:
      test: ["CMD","stat","/etc/passwd","||","exit 1"]
      interval: 1m
      timeout: 10s
      retries: 3

  httpd03:
    image: "httpd:alpine"
    ports:
      - "80"
    mem_limit: 10m
    mem_reservation: 5m
    healthcheck:
      test: ["CMD-SHELL", "stat /etc/passwd || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3

  httpd04:
    image: "httpd:alpine"
    ports:
      - "80"
    mem_limit: 10m
    mem_reservation: 5m
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]
      interval: 1m
      timeout: 10s
      retries: 3

  httpd05:
    image: "httpd:alpine"
    ports:
      - "80"
    mem_limit: 10m
    mem_reservation: 5m
    healthcheck:
      test: ["CMD-SHELL", "stat /etc/passwd || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
